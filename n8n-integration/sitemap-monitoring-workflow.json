{
  "name": "Sitemapç›‘æ§-ç»Ÿä¸€å·¥ä½œæµ",
  "nodes": [
    {
      "parameters": {
        "rule": {
          "interval": [
            {
              "field": "cronExpression",
              "value": "0 */2 * * *"
            }
          ]
        }
      },
      "type": "n8n-nodes-base.cron",
      "position": [240, 300],
      "name": "æ¯2å°æ—¶è§¦å‘"
    },
    {
      "parameters": {
        "authentication": "oAuth2",
        "resource": "sheet",
        "operation": "read",
        "documentId": "YOUR_GOOGLE_SHEET_ID",
        "sheetName": "sitemap-config",
        "options": {}
      },
      "type": "n8n-nodes-base.googleSheets",
      "position": [460, 300],
      "name": "è¯»å–Sheeté…ç½®"
    },
    {
      "parameters": {
        "url": "=https://YOUR_WORKER_DOMAIN.workers.dev/api/status",
        "authentication": "none",
        "requestMethod": "GET",
        "options": {
          "response": {
            "response": {
              "responseFormat": "json"
            }
          }
        }
      },
      "type": "n8n-nodes-base.httpRequest",
      "position": [680, 300],
      "name": "è·å–Workerå½“å‰é…ç½®"
    },
    {
      "parameters": {
        "jsCode": "// å¯¹æ¯”Sheeté…ç½®ä¸Workeré…ç½®ï¼Œæ‰¾å‡ºå·®å¼‚\nconst sheetData = $node[\"è¯»å–Sheeté…ç½®\"].json;\nconst workerData = $node[\"è·å–Workerå½“å‰é…ç½®\"].json;\n\n// è·å–Sheetä¸­çš„æ´»è·ƒç½‘ç«™\nconst sheetUrls = sheetData\n  .filter(item => item.status === 'active')\n  .map(item => item.sitemap_url);\n\n// è·å–Workerä¸­å½“å‰ç›‘æ§çš„ç½‘ç«™\nconst workerUrls = workerData.feeds || [];\n\n// æ‰¾å‡ºéœ€è¦æ·»åŠ å’Œåˆ é™¤çš„ç½‘ç«™\nconst toAdd = sheetUrls.filter(url => !workerUrls.includes(url));\nconst toRemove = workerUrls.filter(url => !sheetUrls.includes(url));\n\n// åˆ›å»ºåŒæ­¥ä»»åŠ¡\nconst syncTasks = [];\n\n// æ·»åŠ æ–°ç½‘ç«™\ntoAdd.forEach(url => {\n  const siteInfo = sheetData.find(item => item.sitemap_url === url);\n  syncTasks.push({\n    action: 'add',\n    url: url,\n    website_name: siteInfo.website_name,\n    notes: siteInfo.notes\n  });\n});\n\n// åˆ é™¤ç½‘ç«™\ntoRemove.forEach(url => {\n  syncTasks.push({\n    action: 'remove',\n    url: url,\n    website_name: 'Unknown',\n    notes: 'Removed from monitoring'\n  });\n});\n\nconst result = {\n  sync_needed: syncTasks.length > 0,\n  sync_tasks: syncTasks,\n  total_active_sites: sheetUrls.length,\n  sites_to_add: toAdd.length,\n  sites_to_remove: toRemove.length,\n  timestamp: new Date().toISOString()\n};\n\nconsole.log('é…ç½®åŒæ­¥åˆ†æ:', result);\n\nreturn [result];"
      },
      "type": "n8n-nodes-base.code",
      "position": [900, 300],
      "name": "åˆ†æé…ç½®å·®å¼‚"
    },
    {
      "parameters": {
        "conditions": {
          "boolean": [
            {
              "value1": "={{ $json.sync_needed }}",
              "operation": "true"
            }
          ]
        }
      },
      "type": "n8n-nodes-base.if",
      "position": [1120, 300],
      "name": "æ£€æŸ¥æ˜¯å¦éœ€è¦åŒæ­¥"
    },
    {
      "parameters": {
        "jsCode": "// å±•å¼€åŒæ­¥ä»»åŠ¡ä¸ºå•ç‹¬çš„é¡¹ç›®\nconst syncData = $input.first().json;\nconst tasks = syncData.sync_tasks;\n\nreturn tasks.map(task => ({\n  ...task,\n  timestamp: syncData.timestamp\n}));"
      },
      "type": "n8n-nodes-base.code",
      "position": [1340, 240],
      "name": "å±•å¼€åŒæ­¥ä»»åŠ¡"
    },
    {
      "parameters": {
        "conditions": {
          "string": [
            {
              "value1": "={{ $json.action }}",
              "operation": "equal",
              "value2": "add"
            }
          ]
        }
      },
      "type": "n8n-nodes-base.if",
      "position": [1560, 200],
      "name": "åˆ†ç¦»æ·»åŠ ä»»åŠ¡"
    },
    {
      "parameters": {
        "conditions": {
          "string": [
            {
              "value1": "={{ $json.action }}",
              "operation": "equal",
              "value2": "remove"
            }
          ]
        }
      },
      "type": "n8n-nodes-base.if",
      "position": [1560, 280],
      "name": "åˆ†ç¦»åˆ é™¤ä»»åŠ¡"
    },
    {
      "parameters": {
        "url": "=https://YOUR_WORKER_DOMAIN.workers.dev/api/feeds/add",
        "authentication": "none",
        "requestMethod": "POST",
        "jsonParameters": true,
        "parametersJson": "={\n  \"url\": \"{{ $json.url }}\"\n}",
        "options": {
          "response": {
            "response": {
              "responseFormat": "json"
            }
          }
        }
      },
      "type": "n8n-nodes-base.httpRequest",
      "position": [1780, 160],
      "name": "æ·»åŠ ç½‘ç«™åˆ°ç›‘æ§"
    },
    {
      "parameters": {
        "url": "=https://YOUR_WORKER_DOMAIN.workers.dev/api/feeds/remove",
        "authentication": "none",
        "requestMethod": "POST",
        "jsonParameters": true,
        "parametersJson": "={\n  \"url\": \"{{ $json.url }}\"\n}",
        "options": {
          "response": {
            "response": {
              "responseFormat": "json"
            }
          }
        }
      },
      "type": "n8n-nodes-base.httpRequest",
      "position": [1780, 280],
      "name": "ä»ç›‘æ§ä¸­åˆ é™¤ç½‘ç«™"
    },
    {
      "parameters": {
        "mode": "combine",
        "combinationMode": "mergeByIndex",
        "options": {}
      },
      "type": "n8n-nodes-base.merge",
      "position": [2000, 220],
      "name": "åˆå¹¶åŒæ­¥ç»“æœ"
    },
    {
      "parameters": {
        "jsCode": "// å¤„ç†åŒæ­¥ç»“æœ\nconst items = $input.all();\nconst results = [];\n\nfor (const item of items) {\n  const data = item.json;\n  results.push({\n    sync_completed: true,\n    action: data.action || 'unknown',\n    url: data.url || 'unknown',\n    success: data.status === 'success',\n    message: data.message || 'Sync completed',\n    timestamp: new Date().toISOString()\n  });\n}\n\n// å¦‚æœæ²¡æœ‰åŒæ­¥ä»»åŠ¡ï¼Œåˆ›å»ºä¸€ä¸ªè·³è¿‡è®°å½•\nif (results.length === 0) {\n  results.push({\n    sync_completed: true,\n    action: 'skip',\n    url: 'none',\n    success: true,\n    message: 'No sync needed, configurations are up to date',\n    timestamp: new Date().toISOString()\n  });\n}\n\nreturn results;"
      },
      "type": "n8n-nodes-base.code",
      "position": [1340, 360],
      "name": "å¤„ç†è·³è¿‡åŒæ­¥"
    },
    {
      "parameters": {
        "mode": "combine",
        "combinationMode": "mergeByIndex",
        "options": {}
      },
      "type": "n8n-nodes-base.merge",
      "position": [2220, 300],
      "name": "åˆå¹¶æ‰€æœ‰åŒæ­¥ç»“æœ"
    },
    {
      "parameters": {
        "url": "=https://YOUR_WORKER_DOMAIN.workers.dev/monitor",
        "authentication": "none",
        "requestMethod": "POST",
        "options": {
          "response": {
            "response": {
              "responseFormat": "json"
            }
          },
          "timeout": 120000
        }
      },
      "type": "n8n-nodes-base.httpRequest",
      "position": [2440, 300],
      "name": "æ‰§è¡Œç›‘æ§ä»»åŠ¡"
    },
    {
      "parameters": {
        "jsCode": "// å¤„ç†ç›‘æ§ç»“æœ\nconst monitorResult = $input.first().json;\nconst timestamp = new Date().toISOString();\n\n// åˆ›å»ºç›‘æ§è®°å½•\nconst result = {\n  timestamp: timestamp,\n  monitoring_completed: true,\n  worker_status: monitorResult.status || 'unknown',\n  worker_message: monitorResult.message || 'Monitoring completed',\n  success: monitorResult.status === 'success',\n  raw_response: JSON.stringify(monitorResult)\n};\n\nreturn [result];"
      },
      "type": "n8n-nodes-base.code",
      "position": [2660, 300],
      "name": "å¤„ç†ç›‘æ§ç»“æœ"
    },
    {
      "parameters": {
        "authentication": "oAuth2",
        "resource": "sheet",
        "operation": "append",
        "documentId": "YOUR_GOOGLE_SHEET_ID",
        "sheetName": "monitoring-logs",
        "options": {
          "cellFormat": "USER_ENTERED"
        }
      },
      "type": "n8n-nodes-base.googleSheets",
      "position": [2880, 240],
      "name": "ä¿å­˜ç›‘æ§æ—¥å¿—"
    },
    {
      "parameters": {
        "authentication": "oAuth2",
        "resource": "sheet",
        "operation": "update",
        "documentId": "YOUR_GOOGLE_SHEET_ID",
        "sheetName": "sitemap-config",
        "columnToMatchOn": "status",
        "valueToMatchOn": "active",
        "options": {
          "cellFormat": "USER_ENTERED"
        },
        "dataToUpdate": {
          "metaData": {
            "columns": [
              {
                "column": "last_check",
                "value": "={{ $json.timestamp }}"
              }
            ]
          }
        }
      },
      "type": "n8n-nodes-base.googleSheets",
      "position": [2880, 360],
      "name": "æ›´æ–°æ£€æŸ¥æ—¶é—´"
    },
    {
      "parameters": {
        "url": "=https://YOUR_WORKER_DOMAIN.workers.dev/test/simple",
        "authentication": "none",
        "requestMethod": "POST",
        "jsonParameters": true,
        "parametersJson": "={\n  \"message\": \"ğŸ“Š n8nç»Ÿä¸€ç›‘æ§å®Œæˆ\\næ—¶é—´: {{ $json.timestamp }}\\nçŠ¶æ€: {{ $json.worker_status }}\\næ¶ˆæ¯: {{ $json.worker_message }}\"\n}",
        "options": {
          "response": {
            "response": {
              "responseFormat": "json"
            }
          }
        }
      },
      "type": "n8n-nodes-base.httpRequest",
      "position": [3100, 300],
      "name": "å‘é€å®Œæˆé€šçŸ¥"
    }
  ],
  "connections": {
    "æ¯2å°æ—¶è§¦å‘": {
      "main": [
        [
          {
            "node": "è¯»å–Sheeté…ç½®",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "è¯»å–Sheeté…ç½®": {
      "main": [
        [
          {
            "node": "è·å–Workerå½“å‰é…ç½®",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "è·å–Workerå½“å‰é…ç½®": {
      "main": [
        [
          {
            "node": "åˆ†æé…ç½®å·®å¼‚",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "åˆ†æé…ç½®å·®å¼‚": {
      "main": [
        [
          {
            "node": "æ£€æŸ¥æ˜¯å¦éœ€è¦åŒæ­¥",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "æ£€æŸ¥æ˜¯å¦éœ€è¦åŒæ­¥": {
      "main": [
        [
          {
            "node": "å±•å¼€åŒæ­¥ä»»åŠ¡",
            "type": "main",
            "index": 0
          }
        ],
        [
          {
            "node": "å¤„ç†è·³è¿‡åŒæ­¥",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "å±•å¼€åŒæ­¥ä»»åŠ¡": {
      "main": [
        [
          {
            "node": "åˆ†ç¦»æ·»åŠ ä»»åŠ¡",
            "type": "main",
            "index": 0
          },
          {
            "node": "åˆ†ç¦»åˆ é™¤ä»»åŠ¡",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "åˆ†ç¦»æ·»åŠ ä»»åŠ¡": {
      "main": [
        [
          {
            "node": "æ·»åŠ ç½‘ç«™åˆ°ç›‘æ§",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "åˆ†ç¦»åˆ é™¤ä»»åŠ¡": {
      "main": [
        [
          {
            "node": "ä»ç›‘æ§ä¸­åˆ é™¤ç½‘ç«™",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "æ·»åŠ ç½‘ç«™åˆ°ç›‘æ§": {
      "main": [
        [
          {
            "node": "åˆå¹¶åŒæ­¥ç»“æœ",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "ä»ç›‘æ§ä¸­åˆ é™¤ç½‘ç«™": {
      "main": [
        [
          {
            "node": "åˆå¹¶åŒæ­¥ç»“æœ",
            "type": "main",
            "index": 1
          }
        ]
      ]
    },
    "åˆå¹¶åŒæ­¥ç»“æœ": {
      "main": [
        [
          {
            "node": "åˆå¹¶æ‰€æœ‰åŒæ­¥ç»“æœ",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "å¤„ç†è·³è¿‡åŒæ­¥": {
      "main": [
        [
          {
            "node": "åˆå¹¶æ‰€æœ‰åŒæ­¥ç»“æœ",
            "type": "main",
            "index": 1
          }
        ]
      ]
    },
    "åˆå¹¶æ‰€æœ‰åŒæ­¥ç»“æœ": {
      "main": [
        [
          {
            "node": "æ‰§è¡Œç›‘æ§ä»»åŠ¡",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "æ‰§è¡Œç›‘æ§ä»»åŠ¡": {
      "main": [
        [
          {
            "node": "å¤„ç†ç›‘æ§ç»“æœ",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "å¤„ç†ç›‘æ§ç»“æœ": {
      "main": [
        [
          {
            "node": "ä¿å­˜ç›‘æ§æ—¥å¿—",
            "type": "main",
            "index": 0
          },
          {
            "node": "æ›´æ–°æ£€æŸ¥æ—¶é—´",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "ä¿å­˜ç›‘æ§æ—¥å¿—": {
      "main": [
        [
          {
            "node": "å‘é€å®Œæˆé€šçŸ¥",
            "type": "main",
            "index": 0
          }
        ]
      ]
    }
  },
  "active": true,
  "settings": {
    "saveDataSuccessExecution": "none",
    "saveDataErrorExecution": "all",
    "saveDataProgressExecution": false,
    "executionTimeout": 3600,
    "saveDataManualExecution": true
  },
  "staticData": null,
  "tags": [
    {
      "createdAt": "2025-07-04T10:00:00.000Z",
      "updatedAt": "2025-07-04T10:00:00.000Z",
      "id": "unified",
      "name": "sitemap-monitoring"
    }
  ]
}